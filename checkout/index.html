<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Checkout | Dónal Ó Gaora</title>
    <link rel="apple-touch-icon" sizes="180x180" href="../assets/favicon.ico/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="../assets/favicon.ico/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="../assets/favicon.ico/favicon-16x16.png" />
    <link rel="manifest" href="../assets/favicon.ico/site.webmanifest" />
    <link rel="icon" href="../assets/favicon.ico/favicon.ico" type="image/x-icon" />
    <!--<link href="../style.css" rel="stylesheet" type="text/css" />!-->
    <style>
      html, body {
        margin: 0;
        padding: 0;
        font-family: Arial, sans-serif;
        min-height: 100vh;
      }
      body {
        background-image: url(../assets/main_background.png);
        background-repeat: no-repeat;
        background-position: right top;
        background-attachment: fixed;
        background-size: cover;
        padding: 20px;
        max-width: 700px;
        margin: auto;
      }
      .cart {
        border: 1px solid #ccc;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        background-color: white; /* Make cart box solid white */
        box-shadow: 0 4px 8px rgba(0,0,0,0.1); /* Optional: nicer visual */
      }
      ul {
        list-style: none;
        padding-left: 0;
      }
      li {
        display: flex;
        align-items: center;
        margin-bottom: 16px;
      }
      li img {
        width: 60px;
        height: auto;
        margin-right: 12px;
        border-radius: 4px;
      }
      .item-details {
        flex: 1;
      }
      .remove-btn {
        background: #c62828;
        color: white;
        border: none;
        padding: 6px 10px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
        margin-left: 12px;
        height: 32px;
      }
      .empty-message {
        text-align: center;
        padding: 40px;
      }
      #paypal-button-container {
        margin-top: 20px;
      }
      tandc-text {
        color: white;
        text-align: center;
        font-family: "Arial Black", sans-serif;
        font-size: 12px;
        padding: 15px;
        max-width: 90%; /* Ensures the text doesn't span the entire width */
        margin: 0 auto; /* Centers the text block within the container */
      }
      .tandc-text-bold {
        color: white;
        text-align: center;
        font-family: "Arial Black", sans-serif;
        font-size: 12px;
        padding: 15px;
        max-width: 90%; /* Ensures the text doesn't span the entire width */
        margin: 0 auto; /* Centers the text block within the container */
        font-weight: bold; /* Ensures the text is bold */
      }
      /* Adjust padding for mobile screens */
      @media (max-width: 600px) {
        tandc-text, tandc-text-bold {
          padding: 10px;  /* Smaller padding for phone screens */
        }
      }
      tandcfooter {
        color: white;
        text-align: center;
        font-family: "Arial", sans-serif;
        font-size: 10px;
        position: fixed;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        background-color: #333333; /* Background color */
        border-radius: 20px; /* Rounded corners for an oval effect */
        padding: 5px 20px; /* Adds padding around the text */
        display: inline-block; /* Ensure the background wraps only around the text */
        white-space: nowrap; /* Prevent wrapping inside the footer */
        max-width: 90%; /* Prevent the footer from stretching too wide */
        box-sizing: border-box; /* Include padding in the width calculation */
      }
      /* Text and link styles for T&C and designer name */
      .footer-tc-text, .designer {
        color: red; /* Text color for both */
        padding: 0; /* Remove padding */
        display: inline; /* Display text inline to remove extra space */
        text-align: center; /* Center the text inside the inline-block */
        margin: 0; /* Ensure no margin between elements */
        background-color: transparent; /* Remove the background color */
      }
      .designer {
        text-decoration: none;
      }    
      /* Ensure no extra space between inline-block elements */
      footer {
        font-size: 0; /* Eliminate gaps between inline-block elements */
      }
      
      footer .footer-text, footer .footer-tc-text, footer .designer {
        font-size: 10px; /* Reset font size for elements to desired size */
      }
      /* Style the T&C link */
      footer a.footer-tc-text {
        text-decoration: none; /* Remove underline */
        color: inherit; /* Ensure the link color is inherited */
      }
      /* Hover effect on T&C text */
      .footer-tc-text:hover {
        color: #24252b; /* Color change on hover */
      }
      /* Shop T&C Text Style */
      .shop-tc-text {
        font-size: 20px; /* Adjusted size to 20px */
        font-weight: bold; /* Bold text */
        color: red; /* Transparent fill color */
        text-decoration: underline; /* Add underline */
        cursor: pointer; /* Pointer cursor to indicate it's clickable */
        padding-left: 10px; /* Space between "Order" and "T&C" */
      }
      /* Hover effect for Shop T&C text */
      .shop-tc-text:hover {
        color: #24252b; /* Color change on hover */
      }
      /* Links style */
      .t7c-links {
        color: red; /* Set the link text color to red */
        text-decoration: none; /* Remove underline */
      }
      .t7c-links:visited {
        color: red; /* Set visited links to red as well */
      }
      .t7c-links:hover {
        text-decoration: underline; /* Add underline on hover */
      }
      /* Responsive Design for Mobile */
      @media screen and (max-width: 500px) {
        page-title {
          font-size: 48px;
        }
        titles {
          font-size: 16px;
        }
        tandcfooter {
          font-size: 10px;
        }
      } 
    </style>
    <!--<style>
      body {
        font-family: sans-serif;
        padding: 20px;
        max-width: 700px;
        margin: auto;
      }
      .cart {
        border: 1px solid #ccc;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
      }
      ul {
        list-style: none;
        padding-left: 0;
      }
      li {
        display: flex;
        align-items: center;
        margin-bottom: 16px;
      }
      li img {
        width: 60px;
        height: auto;
        margin-right: 12px;
        border-radius: 4px;
      }
      .item-details {
        flex: 1;
      }
      .remove-btn {
        background: #c62828;
        color: white;
        border: none;
        padding: 6px 10px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
        margin-left: 12px;
        height: 32px;
      }
      .empty-message {
        text-align: center;
        padding: 40px;
      }
      #paypal-button-container {
        margin-top: 20px;
      }
    </style>-->
  </head>
  <body>
  
    <script src="https://www.paypal.com/sdk/js?client-id=AYyHjVONn6BNCkOwITWnMz4_u636NWpdMkQgLe1ZbmlHGGIhEjXBZfzDDNzs8Ee_qa3I-vAPuWAJSC-l&currency=EUR"></script>
  
    <div class="cart">
      <h2>Your Cart</h2>
      <ul id="cart-items"></ul>
      <p><strong>Total: €<span id="cart-total">0.00</span></strong></p>
    </div>
  
    <div id="paypal-button-container"></div>
  
    <script>
      let cart = JSON.parse(localStorage.getItem('cart')) || [];
      const BACKEND_URL = 'https://shop-api.donalogaora.com';
  
      function calculateTotal() {
        return cart.reduce((sum, item) => sum + item.price * item.qty, 0).toFixed(2);
      }
  
      function renderCart() {
        const cartItemsContainer = document.getElementById('cart-items');
        const cartTotalEl = document.getElementById('cart-total');
  
        if (!cartItemsContainer || !cartTotalEl) return;
  
        if (cart.length === 0) {
          cartItemsContainer.innerHTML = '<p class="empty-message">Your cart is empty.</p>';
          cartTotalEl.textContent = '0.00';
          return;
        }
  
        cartItemsContainer.innerHTML = '';
        let total = 0;
  
        cart.forEach(item => {
          const li = document.createElement('li');
          li.innerHTML = `
            <img src="${item.image || ''}" alt="${item.name} - ${item.color}">
            <div class="item-details">
              <strong>${item.name}</strong><br>
              Color: ${item.color}<br>
              Price: €${item.price.toFixed(2)} x ${item.qty}
            </div>
            <button class="remove-btn" data-id="${item.id}" data-color="${item.color}">Remove</button>
          `;
          cartItemsContainer.appendChild(li);
          total += item.price * item.qty;
        });
  
        cartTotalEl.textContent = total.toFixed(2);
      }
  
      // Handle Remove button clicks with event delegation
      document.getElementById('cart-items').addEventListener('click', (event) => {
        if (event.target.classList.contains('remove-btn')) {
          const id = event.target.getAttribute('data-id');
          const color = event.target.getAttribute('data-color');
  
          // Remove item matching id and color from cart
          cart = cart.filter(item => !(item.id === id && item.color === color));
          localStorage.setItem('cart', JSON.stringify(cart));
          renderCart();
        }
      });
      
      paypal.Buttons({
        createOrder: function(data, actions) {
          const orderItems = cart.map(item => ({
            productId: item.id,
            quantity: item.qty
          }));
      
          return fetch(`${BACKEND_URL}/api/create-order`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ items: orderItems })
          })
          .then(res => res.json())
          .then(data => {
            if (!data.id) throw new Error('No order ID from backend');
            return data.id;
          });
        },
      
        onApprove: function(data) {
          return fetch(`${BACKEND_URL}/api/capture-order`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ orderId: data.orderID })
          })
          .then(res => res.json())
          .then(details => {
            if (details.status === 'COMPLETED') {
              alert(`Thank you, ${details.payer.name.given_name}! Your order is confirmed.`);
              localStorage.removeItem('cart');
              window.location.href = `thank-you/index.html?name=${encodeURIComponent(details.payer.name.given_name)}`;
            } else {
              alert('Payment not completed');
            }
          })
          .catch(err => {
            console.error(err);
            alert('Payment failed. Please try again.');
          });
        },
      
        onError: function(err) {
          console.error('PayPal error', err);
          alert('An error occurred with PayPal.');
        }
      }).render('#paypal-button-container');
      
      renderCart();
    </script>
    <br><br><br><br><br><br>
    <tandcfooter>
       <span class="footer-text">shop.donalogaora.com </span>
          <a href="https://shop.donalogaora.com/terms-and-conditions" class="footer-tc-text" target="_blank" rel="noopener noreferrer">T&Cs</a><br>
       <span class="footer-text">© 2025 
          <a href="https://www.github.com/donalogaora" class="designer" target="_blank">Dónal Ó Gaora</a>. All Rights Reserved.
       </span><br>
       <span class="footer-text">Designed by 
          <a href="https://www.github.com/donalogaora" class="designer" target="_blank">Dónal Ó Gaora</a>
       </span>
    </tandcfooter>
  </body>
</html>
